/*! jquery.price-autocomplete 2013-09-26 */
!function(a){"use strict";function b(b,c){this.$element=a(b),this.options=a.extend({},g,c),this.$element.on("focus",a.proxy(this.focus,this))}function c(a){return parseInt("number"==typeof a.which?a.which:a.keyCode,10)}function d(a){var b=a+"0";return a.length<4?d(b):a.length<8?b:null}function e(a){var b=a.toString().replace(/[^\d]/g,""),c=parseInt(b,10),e=[];if(!isNaN(c)&&(c>9999&&e.push(b),0!==c))for(var f=d(b);null!==f;)e.push(f),f=d(f);return e}var f="priceAutocomplete",g={formatter:null,formatterOptions:null,className:f,prefix:"",suffix:" kr"};b.prototype={init:function(){this.$autocomplete=a("<ul></ul>",{"class":this.options.className}).hide(),a("body").append(this.$autocomplete),this.$autocomplete.on("mousedown","li",a.proxy(this.mousedown,this)),this.$autocomplete.on("mouseenter","li",a.proxy(this.mouseenter,this)),this.$autocomplete.on("mouseleave","li",a.proxy(this.mouseleave,this)),this.$element.on("blur",a.proxy(this.blur,this)),this.$element.on("keydown",a.proxy(this.keydown,this)),this.$element.on("keyup",a.proxy(this.keyup,this));var b=this.$element.offset();b.top+=this.$element.height()+8,b.width=Math.max(this.$element.height(),100),this.$autocomplete.css(b)},focus:function(){this.$autocomplete?this.$autocomplete.show():this.init()},blur:function(){this.$autocomplete.hide()},keydown:function(a){switch(c(a),c(a)){case 13:a.preventDefault(),this.click();break;case 40:a.preventDefault(),this.walk(1);break;case 38:a.preventDefault(),this.walk(-1);break;case 27:this.blur()}},keyup:function(b){if(-1===[13,40,38,27,37,39].indexOf(c(b))){this.setValue(this.format(this.$element.val()));var d="";a.each(e(this.$element.val()),a.proxy(function(a,b){d+="<li>"+this.format(b,!0)+"</li>"},this)),""!==d?this.$autocomplete.html(d).show():this.blur()}},mouseenter:function(b){this.$autocomplete.find("li").removeClass("selected"),a(b.target).addClass("selected")},mouseleave:function(b){a(b.target).removeClass("selected")},mousedown:function(){this.setValue(this.$autocomplete.find(".selected").html())},setValue:function(a){a=a.replace(this.options.suffix,""),this.$element.val(a)},walk:function(a){var b=this.$autocomplete.find(".selected");b.length?(b[a>0?"next":"prev"]().addClass("selected"),b.removeClass("selected")):this.$autocomplete.find("li:"+(a>0?"first":"last")).addClass("selected")},remove:function(){this.$element.off(),this.$autocomplete.off().remove()},format:function(a,b){return a=a.toString().replace(/[^\d]/g,""),this.options.formatter&&(a=this.options.formatter(a,this.options.formatterOptions)),b&&""!==a&&(a=this.options.prefix+a+this.options.suffix),a}},a.fn[f]=function(c){return this.each(function(){a.data(this,"plugin_"+f)||a.data(this,"plugin_"+f,new b(this,c))})}}(jQuery);