/*! jquery.price-autocomplete 2013-09-27 */
!function(a){"use strict";function b(b,c){this.$element=a(b),this.options=a.extend({},h,c),this.$element.on("focus",a.proxy(this.focus,this))}function c(a){return a.toString().replace(/[^\d]/g,"")}function d(a){return parseInt("number"==typeof a.which?a.which:a.keyCode,10)}function e(a){var b=a+"0";return a.length<4?e(b):a.length<8?b:null}function f(a){var b=c(a),d=parseInt(b,10),f=[];if(!isNaN(d)&&(d>9999&&f.push(b),0!==d))for(var g=e(b);null!==g;)f.push(g),g=e(g);return f}var g="priceAutocomplete",h={formatter:null,formatterOptions:null,className:g,prefix:"",suffix:" kr",unmaskInput:!1,removeFixInput:!1};b.prototype={init:function(){this.$autocomplete=a("<ul></ul>",{"class":this.options.className}).hide(),a("body").append(this.$autocomplete),this.$autocomplete.on("mousedown","li",a.proxy(this.mousedown,this)),this.$autocomplete.on("mouseenter","li",a.proxy(this.mouseenter,this)),this.$autocomplete.on("mouseleave","li",a.proxy(this.mouseleave,this)),this.$element.on("blur",a.proxy(this.blur,this)),this.$element.on("keydown",a.proxy(this.keydown,this)),this.$element.on("keyup",a.proxy(this.keyup,this));var b=this.$element.offset();b.top+=this.$element.height()+8,b.width=Math.max(this.$element.height(),100),this.$autocomplete.css(b)},focus:function(){this.$autocomplete?this.$autocomplete.show():this.init()},blur:function(){this.$autocomplete.hide()},keydown:function(a){switch(d(a),d(a)){case 13:a.preventDefault(),this.mousedown();break;case 40:a.preventDefault(),this.walk(1);break;case 38:a.preventDefault(),this.walk(-1);break;case 27:this.blur()}},keyup:function(b){if(-1===[13,40,38,27,37,39].indexOf(d(b))){this.setValue(this.format(this.$element.val()));var c="";a.each(f(this.$element.val()),a.proxy(function(a,b){c+="<li>"+this.format(b,!0)+"</li>"},this)),""!==c?this.$autocomplete.html(c).show():this.blur()}},mouseenter:function(b){this.$autocomplete.find("li").removeClass("selected"),a(b.target).addClass("selected")},mouseleave:function(b){a(b.target).removeClass("selected")},mousedown:function(){this.setValue(this.$autocomplete.find(".selected").html()),this.blur()},setValue:function(a){this.options.removeFixInput&&(a=a.replace(this.options.prefix,"").replace(this.options.suffix,"")),this.options.unmaskInput&&(a=c(a)),this.$element.val(a)},walk:function(a){var b=this.$autocomplete.find(".selected");b.length?(b[a>0?"next":"prev"]().addClass("selected"),b.removeClass("selected")):this.$autocomplete.find("li:"+(a>0?"first":"last")).addClass("selected")},remove:function(){this.$element.off(),this.$autocomplete.off().remove()},format:function(a,b){return a=c(a),this.options.formatter&&(a=this.options.formatter(a,this.options.formatterOptions)),b&&""!==a&&(a=this.options.prefix+a+this.options.suffix),a}},a.fn[g]=function(c){return this.each(function(){a.data(this,"plugin_"+g)||a.data(this,"plugin_"+g,new b(this,c))})}}(jQuery);